Из журнала Adventurer #7, Рыбинск, 1997



      REAL SOFTWARE/NHG'1997,г.Брест



    Поиск адреса  спрайта в архиве от
          SPRITES GENERATOR 'а.

     Иногда  ,  бывает  удобнее хранить в
программе таблицу спрайтов, особенно если
все  они  разных размеров. Для этих целей
вам  необходимо просто переименовать рас-
ширение  архива  спрайтов  с "s" на "C" и
использовать  в  своих программах. Напри-
мер, удобно использовать архив в тексте с
картинками:  сам  архив  располагается  в
конце  текста (можно и в начале), а в са-
мом тексте ставится управляющий код и но-
мер  спрайта.  Предлагаемая подпрограммка
позволит  вам, не вникая в формат архива,
без  проблем  рассчитывать  в  нем  адрес
спрайта.  Но  все же, если кто-то захочет
разобраться в формате архива, то почитай-
те  описание  к  самой  программе SPRITES
GENERATOR , например для того, если у вас
возникнет желание написать программу ани-
мации или еще что-нибудь,использующее эти
архивы.

     ; STABL  -адрес  архива  На входе: в
A-номер  спрайта  (1... 255), задав номер
последнего спрайта+1, вы определите нача-
ло  свободной памяти. На выходе: HL-адрес
спрайта,  DE-длина  ; IX-таблица парамет-
ров:  ;(  IX+0)  -ширина, (IX+1) -высота,
(IX+2)  -тип ;( о типах спрайтов см. HELP
для SGEN'а).

PRSN   LD      IX,STABL-2
       PUSH    AF
       LD      L,(IX+2)
       LD      H,0
       LD      D,H
       LD      E,L
       ADD     HL,HL
       ADD     HL,DE
       LD      DE,STABL+5
       ADD     HL,DE
       POP     AF
PRSN1  INC     IX
       INC     IX
       INC     IX
       PUSH    BC
       PUSH    HL
       LD      HL,0
       PUSH    HL
       LD      E,(IX+0)
       LD      D,0
       LD      B,(IX+1)
PRSN2  ADD     HL,DE
       DJNZ    PRSN2
       LD      B,(IX+2)
       EX      DE,HL
       POP     HL
PRSN3  ADD     HL,DE
       DJNZ    PRSN3
       EX      DE,HL
       POP     HL
       POP     BC
       DEC     A
       RET     Z
       ADD     HL,DE
       JR      PRSN1

     P.S:  Недопустимо  использование ар-
хивов  в  динамичных  программах, так как
расчет  адреса  спрайта в архиве отнимает
процессорное время.