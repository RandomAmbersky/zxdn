<pre>
Из журнала Deja Vu #07, Кемерово, 1999



(C) AXLR

==========================================
     Доработка Pentagon'a для работы
       с дисками высокой плотности
==========================================

   Итак, что же нужно сделать, чтобы обыч-
ный контроллер заработал с дисками высокой
плотности? Если в компьютере уже  установ-
лен турбо-режим, тогда  на  все  доработки
уходит буквально час, а если  нет, что ж -
- здесь предлагается уже доработанная схе-
ма турбы для Пентагона - собирайте.
   Так вот, даже если  турбина  у  вас уже
есть, ее придется немного доделать. Собст-
венно, доработки здесь две: одна для вклю-
чения  турбы, когда  работает  ДОС, другая
формирует /wait при обращении процессора к
портам.
   О последней следует сказать  особо. За-
мечено,что некоторые экземпляры КР1818ВГ93
а именно, 1993 и более позднего  года  вы-
пуска, плохо работают в турбе. На качество
обмена с диском это вроде бы и  не  влияет
(специально не  тестировали), но  кто  ее,
ВГшку, знает.
   Лучше всего будет привести полную схему
турбы для Пентагона, но уже с доработками:
</pre>
<img src=dv07vghd/pic1.gif>
<pre>
   Сигнал HLD берется с 28й ноги ВГ93, /IP
- с ВГ93:35, /IORQ  - с Z80:20, а /bit7#FF
- см. ниже.

   Для турбы:

 1. Отключить D5:2 и D13:28 (D5:13);
 2. Отключить D15:1 от +5В,
    подать на D15:1 сигнал /RFSH (D13:28);
 3. Отсоединить D13:6 от  D1:8  так, чтобы
    осталась связь между D13:6 и  резисто-
    ром, соединяющим его с +5В.

   Кстати, AY-3-8910  (не  YAMAHA!)  также
плохо работает в турбе, как и ВГ93,так что
эта доработка решит и  проблему  тормозных
AY.
   Повторюсь: для нормальной работы  турбы
НУЖНО менять диод VD2 в схеме контроллера.
Если его не заменить, большинство турболо-
адеров в турбе будут  глючить, так как для
доступа к  подпрограммам  ДОСа  используют
jp #3d30. В турбе этот  самый  VD2  сильно
тормозит переключение страниц ПЗУ(ДОС/Бей-
сик). В итоге - знакомые всем эффекты: за-
пущенное висит и/или гадит на диск...

   Вот схема замены диода VD2 (по Пентаго-
новской схеме контроллера):

    Как там есть:
</pre>
<img src=dv07vghd/pic2.gif>
<pre>
   А как должно быть:
</pre>
<img src=dv07vghd/pic3.gif>
<pre>
   Ну а вот, собственно, сама схема  дора-
ботки контроллера BETA-DISK-TURBO в  BETA-
-DISK-TURBO-HD :)
</pre>
<img src=dv07vghd/pic4.gif>
<pre>
 Микросхемы:
DD1: 1533КП11, DD2: 1533ЛЕ1, DD3: 1533ТМ2, DD4: 1533ЛЛ1,
DD5: 1533ТМ2, DD6: 1533ЛИ1, DD7: 1533ИЕ7, DD8: 1533Л 1,
DD9: 1533(555)КП11

   Любая микросхема, кроме DD8(Л 1) и  DD9
(КП11) может быть заменена на  аналогичную
серии 555, это будет отражаться только  на
нагрузке на БП.
   Старые сигналы, идущие на  DD76:3, 2МГц
на TURBO-ВГ - ОТРЕЗАТЬ!

   Сигнал с DD5:9 доработки,идущий на мик-
рик HD/DD в дисководе можно  не  буфериро-
вать (никогда его не буферировал, а  шлейф
на дисковод у меня-1м, и все ОК). Сам мик-
рик HD/DD расположен на  плате  двигателя,
как раз над отверстием "HD" в  диске  (его
еще обычно заклеивают). На одну ногу  мик-
рика идет обычно общий провод, а  с другой
снимается управляющий сигнал для микросхе-
мы. Вот на вторую  ногу  и  подаем  сигнал
"HD/DD". Да, с дисков теперь НУЖНО  убрать
наклейки (на 3.5"- наклейки!маразм..). Ес-
ли собираетесь пользоваться 720К 3.5" дис-
ками (на  них отверстия "HD" нет), заранее
пропустите сигнал "HD/DD"  через  резистор
50..100 Ом, а только  потом  подавайте  на
микрик в драйве.
   Вообще-то, в Пентагоне этот  генератор-
-16МГц не был бы нужен, но т.к. чуть ли не
у всех пентагонщиков стоит ФАПЧ на 556РТ4,
то и схема дана с учетом его присутствия в
контроллере. Если ФАПЧ  нет, то  на  DD9:2
нужно  подавать DD76:6, на DD9:3 - DD86:6,
а отрезать тогда нужно DD76:6 от DD92:3.

       Как оно все вместе работает?

   Режим плотности (обычная/высокая) пере-
ключается программно, bit7 порта #FF конт-
роллера:

  bit7=0 - обычная,
  bit7=1 - высокая плотность.

   К счастью, так получилось,что все прог-
раммы, работающие с диском,держат этот бит
всегда в одном и том же состоянии: в нуле.
Сделав доработку, можно спокойно запускать
старые проги, они также,как и раньше будут
работать с дисками 360К-720К.
   Надо сказать,без турбы это не работает,
т.к. скорость обмена  возрастает  ровно  в
два раза (на  ВГ93  подается  2МГц  вместо
1МГц)-теперь она составляет более 60К/сек.
Включая турбо-режим при  выполнении  прог-
раммы из ПЗУ ДОСа, добиваемся того, что  у
Z80 по-прежнему остается около 112  тактов
на цикл  обмена и он, Z80, работает с ВГ93
также, как и на обычной плотности.
   На высокой плотности на диск влезает до
18ти 512байт-секторов(формат 1.44М) или до
10ти 1024-байтных ( нестандартный, но тоже
формат- 1.6Мb). Таким образом,запросто чи-
таются/пишутся HD-диски MSDOS(PS/2).
   После доработки турбы она будет  всегда
включаться при дисковых операциях,но толь-
ко после того,как диск успеет  раскрутить-
ся. Если  обмен  с  диском идет на обычной
плотности,турбо-режим можно отключить мик-
риком "TURBO/NORMAL"  (интересно, что  это
понадобилось для одной-единственной проги:
FUT by MI&DI). Если турба  была  включена,
она  отключается на время раскрутки диска,
а потом снова включается.
   При позиционировании на доработку TURBO
-ВГ всегда идет 2МГц, к сожалению,на более
высокой частоте ВГшка не работает.
   По слухам,на какой-то из двух резервных
контактов разъема  дисковода  5.25" должен
идти сигнал управления скоростью  вращения
двигателя. На моем Мицуми 3.5" оба резерв-
ных никуда не идут. Так вот,я подал сигнал
"HD/DD" через 2й резервный контакт (прону-
мерован как 4-й на дисководном разъеме), -
- и у меня отлично работает, и на PC.

P.S. Все обозначения элементов даны по той
схеме Пентагона, в которой адресные сигна-
лы Z80 обозначены А1-А16. К сожалению, без
снятия кожуха дисковода никак не обойтись,
зато всех переделок в нем - один проводок.

P.P.S. Новая схема турбо-режима была  пре-
доставлена мне Романом  Милюковым, за  что
ему большое спасибо!
</pre>