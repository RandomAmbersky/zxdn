<pre>
Из журнала Deja Vu #09, Кемерово, 1999



(C) 1998-1999 AXLR
__________________________________________

==========================================
      Доработка контроллера
     для работы с HD-дисками
==========================================

   Здесь дана схема  турбо-режима, обеспе-
чивающая более высокое быстродействие, чем
старая. Новая по тестам дает  более 113000
тактов/инт.
   Также здесь имеется усовершенствованная
схема переключения тактовой частоты  ВГ93,
теперь это должно работать на любом Пента-
гоне.

==========================================
       Схема турбо-режима Z80-7MГц
       для компьютера Pentagon-128
==========================================
</pre>
<img src=dv09fdhd/pic1.gif>
<pre>
   Сигнал HLD берется ВГ93:28, /IP-с ВГ93:
:35, /IORQ - с Z80:20, а /bit7#FF -см. ни-
же.

==========================================
    Необходимые переключения/доработки
           на плате компьютера:
==========================================

 1. Отсоединяем DD5:2(ЛИ3) от Z80:28.
 2. Отсоединяем DD15:1(ТМ2) от +5В, подаем
на этот DD15:1 сигнал /RFSH (Z80:28).
 3. Отсоединяем Z80:6  от  DD1:8(Л 1) так,
чтобы осталась связь между Z80:6 и  резис-
тором, соединяющим его(резистор) с +5В.
 4. Сигнал с DD45:10(ТМ8) подаем на Z80:6.
 5. Заменяем цепь VD2+R13 в схеме контрол-
лера на элемент ЛИ1, свободный элемент ЛИ1
находим на плате компьютера:

    как должно быть:
</pre>
<img src=dv09fdhd/pic2.gif>
<pre>

 6. Сигнал, исходящий из  DD64:13(ЛЕ1) от-
соединяем  от  DD62:9(ТМ9), пропускаем его
через имеющийся элемент ЛА3 и только затем
подаем снова на DD62:9, вот так:
</pre>
<img src=dv09fdhd/pic3.gif>
<pre>
 7. Сигнал с DD76:9(TM2) подаем  на DD36:1
(27c512), старый сигнал от DD36:1 отсоеди-
няем.

 8. При необходимости меняем  DD76(TM2) на
более быстродействующую, серии 1533.

==========================================

  Собственно, доработка для переключения
          тактовой частоты ВГ93
         + доработка "турбо-ВГ".

   Здесь даны  две схемы, первая учитывает
наличие в контроллере участков, использую-
щих частоту  8МГц (например, схема  ФАПЧ);
вторая - для  контроллеров, таких участков
не имеющих.
   Без доработок пентагоновский контроллер
использует только 4МГц, поэтому, если ФАПЧ
в схеме контроллера  не  обнаружено, имеет
смысл  на  такие  Пентагоны ставить вторую
схему.


        Если ФАПЧ на 556РТ4 есть,
        то собираем нижеследующее:
</pre>
<img src=dv09fdhd/pic4.gif>
<pre>
Сигнал D7 - берем с Z80:13.
/STEP - с дисководного разъема.

   В контроллере старый  сигнал, исходящий
из DD86:6(Л 1) на  DD76:3(ТМ2) - отрезаем.
Вместо 8МГц на схему ФАПЧ подаем  сигнал с
D1:6(ЛА3 на доработке, см.выше).
   Вместо кварца 8МГц ставим  кварц-16МГц.
Если DD86 (Л 1) серии 155 или 555,рекомен-
дуется заменить ее на 1533Л 1. Иначе гене-
ратор, собранный на этой DD86 может не за-
пускаться.


       Если же ФАПЧ на 556РТ4 нет,
             то собираем так:
</pre>
<img src=dv09fdhd/pic5.gif>
<pre>
Сигнал D7 берем с Z80:13.
/STEP - с дисководного разъема.

   В контроллере  отсоединяем  DD76:4(ТМ2)
от +5В; сигнал, исходящий из DD76:6  отре-
заем от DD92:3(ТМ2),DD92:11 и DD93:2(ИЕ10)
таким образом, чтобы эти три вывода микро-
схем (DD92:3, DD92:11 и DD93:2)  были сое-
динены между собой.
==========================================

 Mикросхемы, использованные в доработке:

  D1: 1533ЛА3, D2: 1533TM2, D3: 1533КП11,
  D4: 1533ЛЛ1, D5: 1533TM2, D6: 1533ЛИ1,
  D7: 1533ИЕ7, D8: 1533TM2, D9: 1533ЛЛ1,
  D10: 1533ТМ2.

   Любая микросхема,кроме D1(ЛА3), D8(ТМ2)
и D9(ЛЛ1) может быть заменена на аналогич-
ную серии 555. Если кварц-16МГц не исполь-
зовался, все микросхемы можно ставить  се-
рии 555.

   Как видно, здесь уже собрана  доработка
"турбо-ВГ". Если на дорабатываемом компью-
тере она уже стояла,то ставить точно такой
же элемент  ТМ2  не  нужно, но  необходимо
взять с уже  имеющегося  сигнал (инверсный
выход триггера) и подать на D6:13 доработ-
ки.

   Сигнал "HD/DD" рекмендуется подавать на
дисководный микрик через 2й резервный кон-
такт (пронумерован как 4й  на  дисководном
разъеме) - для 5.25"(1.2М)- дисководов это
стандартный  сигнал  управления  скоростью
вращения  диска  (300/360  об/м),  а  3.5"
(1.44М) - дисководах это,обычно, свободный
контакт.
   Микрик HD/DD расположен на плате двига-
теля, над отверстием  "HD"  в  диске (его,
обычно, заклеивают). На одну ногу  микрика
идет общий  провод, а  с  другой снимается
управляющий сигнал для микросхемы дисково-
да. Вот на вторую ногу  микрика  и  подаем
сигнал "HD/DD".

   Внимание! Если подключается 5.25"(1.2M)
- дисковод, то необходимо просто подать на
него сигнал "HD/DD", а дорабатывать  в нем
ничего не нужно, там уже все есть.

         *          *          *

   При установке данной  доработки  не  на
Пентагон, главная проблема  заключается  в
согласовании управления турбо-режимом  до-
работки со схемой турбы в  компьютере. Все
остальное делается также, как и на  Пента-
гоне: собирается доработка  в  контроллере
для переключения частот 8/16 МГц, добавля-
ется bit7  в  системный  порт  контроллера
(порт #FF) и  собирается  "турбо-ВГ", если
ее еще нет. Необходимо  обратить  внимание
на наличие  в  схеме  турбы  формирователя
/wait при обращении  процессора  к портам.
Если такой участок отсутствует, рекоменду-
ется собрать его, например, как предложено
выше (здесь собран на ИЕ7 и ЛЛ1).

   Если в компьютере присутствует програм-
мное управление  турбо-режимом, переключа-
тель "турбо/норма" можно выполнить
как показано ниже:
</pre>
<img src=dv09fdhd/pic6.gif>
<pre>
где:
    /DOSROM - сигнал в контроллере, низким
     уровнем переключающий  (страницы) ПЗУ
     с Basic на TRDOS;
    TURBO - сигнал программного управления
     турбо-режимом, высоким уровнем  вклю-
     чающий режим "турбо" Z80.
    /bit7#FF - см. выше;
    /IP - ВГ93:35;
    HLD - ВГ93:28.
</pre>